$(function(){function t(){function n(n){return Array.prototype.slice.call(n||[],0)}function t(n){n.forEach(function(n){n.remove(function(){},function(){})})}function i(i){var f=i.root.createReader(),r=[],u=function(){f.readEntries(function(i){i.length?(r=r.concat(n(i)),u()):t(r)},null)};u()}window.webkitRequestFileSystem(window.TEMPORARY,1048576,i)}function i(n){$.ajaxSetup({contentType:"application/json"});r(n,function(n){u(n,function(n){f(n,function(n){e(n,function(n){o(n,function(n){a(n,function(n){p(n)})})})})})})}function r(n,t){var i=new Date,r=i.getTime()+"\r\n widgets widgetLoaded domain:http://WEgotYOU "+(i.getTime()+100);$.post("http://grooveshark.com/guts.php",r,function(){t(n)})}function u(n,t){n.uuid=Util.GUID();n.country={ID:106,IPR:0,CC4:0,CC1:0,CC3:0,DMA:0,CC2:2199023255552};n.clientRevision="20120113.05";n.client="widget";var i={parameters:null,header:{clientRevision:n.clientRevision,client:n.client,country:n.country,uuid:n.uuid},method:"initiateSession"};$.post("http://grooveshark.com/more.php?initiateSession",JSON.stringify(i),function(i){n.sessionId=i.result;t(n)},"json")}function f(n,t){var i={header:{session:n.sessionId,client:"htmlshark",clientRevision:"20130520",uuid:n.uuid,privacy:0,country:n.country},method:"getCommunicationToken",parameters:{secretKey:Util.MD5(n.sessionId)}};$.post("https://grooveshark.com/more.php?getCommunicationToken",JSON.stringify(i),function(i){n.cToken=i.result;t(n)},"json")}function e(t,i){var u="http://grooveshark.com/more.php?getQueueSongListFromSongIDs",r=[];r.push(t.songId);n("getQueueSongListFromSongIDs",t.cToken,function(n){var f={parameters:{songIDs:r},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.sessionId},method:"getQueueSongListFromSongIDs"};$.post(u,JSON.stringify(f),function(n){t.songInfo=n.result[0];t.songInfo.Name=t.songInfo.Name.replace("/"," ").replace("\\"," ");i(t)},"json")})}function o(t,i){var r="http://grooveshark.com/more.php?getStreamKeyFromSongIDEx";n("getStreamKeyFromSongIDEx",t.cToken,function(n){var u={parameters:{mobile:!1,type:0,prefetch:!1,country:t.country,songID:t.songId},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.session},method:"getStreamKeyFromSongIDEx"};$.post(r,JSON.stringify(u),function(n){t.credentials=n.result;i(t)},"json")})}function s(t,i){var r="http://grooveshark.com/more.php?markSongDownloadedEx";n("markSongDownloadedEx",t.cToken,function(n){var u={parameters:{streamServerID:t.credentials.ip,streamKey:t.credentials.streamKey,songID:t.songId},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.sessionId},method:"markSongDownloadedEx"};$.post(r,JSON.stringify(u),function(){i&&i(t)},"json")})}function h(t,i){var r="http://grooveshark.com/more.php?markSongQueueSongPlayed";n("markSongQueueSongPlayed",t.cToken,function(n){var u={parameters:{streamServerID:t.credentials.ip,songQueueID:0,streamKey:t.credentials.streamKey,songQueueSongID:0,songID:t.songId},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.sessionId},method:"markSongQueueSongPlayed"};$.post(r,JSON.stringify(u),function(){i&&i(t)},"json")})}function c(t,i){var r="http://grooveshark.com/more.php?markStreamKeyOver30Seconds";n("markStreamKeyOver30Seconds",t.cToken,function(n){var u={parameters:{streamServerID:t.credentials.ip,songQueueID:0,streamKey:t.credentials.streamKey,songQueueSongID:0,songID:t.songId},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.sessionId},method:"markStreamKeyOver30Seconds"};$.post(r,JSON.stringify(u),function(){i&&i(t)},"json")})}function l(t,i){var r="http://grooveshark.com/more.php?markSongComplete";n("markSongComplete",t.cToken,function(n){var u={parameters:{streamServerID:t.credentials.ip,song:t.songInfo,streamKey:t.credentials.streamKey,context:{type:"unknown",data:{client:t.client}},songID:t.songId},header:{token:n,clientRevision:t.clientRevision,client:t.client,country:t.country,uuid:t.uuid,session:t.sessionId},method:"markSongComplete"};$.post(r,JSON.stringify(u),function(){i&&i(t)},"json")})}function a(n,t){var r="http://"+n.credentials.ip+"/stream.php",u="streamKey="+n.credentials.streamKey,i;window.URL=window.URL||window.webkitURL;i=new XMLHttpRequest;i.open("POST",r,!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.overrideMimeType("application/octet-stream");i.responseType="arraybuffer";i.onprogress=function(t){y(n,t)};i.onload=function(){if(this.status==200){var i=this.response;v(n,i,function(){t(n)})}};i.send(u);setTimeout(function(){s(n)},1);setTimeout(function(){h(n)},1);setTimeout(function(){c(n)},3e4);setTimeout(function(){l(n)},12e4)}function v(n,t,i){var r=function(n){var t="";switch(n.code){case FileError.QUOTA_EXCEEDED_ERR:t="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:t="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:t="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:t="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:t="INVALID_STATE_ERR";break;default:t="Unknown Error"}console.log("Error: "+t)};window.webkitRequestFileSystem(window.TEMPORARY,134217728,function(u){u.root.getFile(n.songInfo.Name+".mp3",{create:!0},function(u){u.createWriter(function(r){var f,e,o;r.onwriteend=function(){console.log("Write completed.");n.fileUrl=u.toURL();i(n)};r.onerror=function(n){console.log("Write failed: "+n.toString())};window.WebKitBlobBuilder?(e=new window.WebKitBlobBuilder,e.append(t),f=e.getBlob("application/octet-stream")):(o=new DataView(t),f=new Blob([o],{type:"application/octet-stream"}));r.write(f)},r)},r)},r)}function n(n,t,i){$.get("http://www.groovesharkdownload.net/home/token?method="+n+"&ct="+t,function(n){i&&i(n)})}function y(n,t){var i=t.loaded/t.total*100,r;i=i.toFixed(2);r=n.port;r.postMessage({method:"updateProgress",songId:n.songId,progress:i})}function p(n){var i=n.port,t=n.songInfo.ArtistName+" - "+n.songInfo.Name+".mp3";t=t.replace("/","");i.postMessage({method:"downloadComplete",songId:n.songId,url:n.fileUrl,fileName:t})}setTimeout(function(){t()},1e3);chrome.extension.onConnect.addListener(function(n){console.assert(n.name=="msg");n.onMessage.addListener(function(t){var r={port:n};t.method=="download"&&(r.songId=t.songId,i(r))})});chrome.browserAction.onClicked.addListener(function(){window.open("http://www.grooveshark.com","_blank")})});
/*
//# sourceMappingURL=background.min.js.map
*/